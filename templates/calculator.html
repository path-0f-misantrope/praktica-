{{define "content_calculator"}}

<div class="card">
    <h2>üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—ã—Ä—å—è</h2>
    <p style="color: #6b7280; margin-bottom: 20px;">
        –†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—ã—Ä—å—è –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ –ø—Ä–æ–¥—É–∫—Ü–∏–∏ —Å —É—á–µ—Ç–æ–º –ø–æ—Ç–µ—Ä—å
    </p>

    <div id="error-message" class="alert alert-error" style="display: none;"></div>
    <div id="success-message" class="alert alert-success" style="display: none;"></div>

    <form id="calculator-form">
        <div class="form-group">
            <label for="product_type_id">–¢–∏–ø –ø—Ä–æ–¥—É–∫—Ü–∏–∏ *</label>
            <select id="product_type_id" name="product_type_id" required>
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –ø—Ä–æ–¥—É–∫—Ü–∏–∏...</option>
                {{range .Types}}
                <option value="{{.ID}}">{{.TypeName}}</option>
                {{end}}
            </select>
        </div>

        <div class="form-group">
            <label for="material_type_id">–¢–∏–ø –º–∞—Ç–µ—Ä–∏–∞–ª–∞ *</label>
            <select id="material_type_id" name="material_type_id" required>
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª...</option>
                {{range .Materials}}
                <option value="{{.ID}}">{{.MaterialName}}</option>
                {{end}}
            </select>
        </div>

        <div class="form-group">
            <label for="product_quantity">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥—É–∫—Ü–∏–∏ *</label>
            <input type="number" id="product_quantity" name="product_quantity" 
                   min="1" step="1" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ" required>
        </div>

        <div class="form-group">
            <label for="param1">–ü–∞—Ä–∞–º–µ—Ç—Ä –ø—Ä–æ–¥—É–∫—Ü–∏–∏ 1 *</label>
            <input type="number" id="param1" name="param1" 
                   min="0.01" step="0.01" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ" required>
            <small style="color: #6b7280; font-size: 12px;">–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ</small>
        </div>

        <div class="form-group">
            <label for="param2">–ü–∞—Ä–∞–º–µ—Ç—Ä –ø—Ä–æ–¥—É–∫—Ü–∏–∏ 2 *</label>
            <input type="number" id="param2" name="param2" 
                   min="0.01" step="0.01" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ" required>
            <small style="color: #6b7280; font-size: 12px;">–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ</small>
        </div>

        <div class="actions">
            <button type="submit" class="btn btn-primary">üìä –†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
            <button type="reset" class="btn">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</button>
        </div>
    </form>

    <div id="result-container" style="display: none; margin-top: 30px;">
        <div class="card" style="background: #f0f9ff; border: 2px solid #667eea;">
            <h3 style="color: #667eea; margin-bottom: 15px;">üìã –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—á–µ—Ç–∞</h3>
            <div style="font-size: 18px; margin-bottom: 10px;">
                <strong>–ù–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—ã—Ä—å—è:</strong>
                <span id="result-quantity" style="color: #667eea; font-size: 24px; font-weight: bold; margin-left: 10px;"></span>
                <span style="color: #6b7280; font-size: 16px;">–µ–¥–∏–Ω–∏—Ü</span>
            </div>
            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e5e7eb; color: #6b7280; font-size: 14px;">
                <div><strong>–¢–∏–ø –ø—Ä–æ–¥—É–∫—Ü–∏–∏:</strong> <span id="result-product-type"></span></div>
                <div style="margin-top: 5px;"><strong>–ú–∞—Ç–µ—Ä–∏–∞–ª:</strong> <span id="result-material"></span></div>
                <div style="margin-top: 5px;"><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥—É–∫—Ü–∏–∏:</strong> <span id="result-product-qty"></span></div>
                <div style="margin-top: 5px;"><strong>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:</strong> <span id="result-params"></span></div>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('calculator-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        document.getElementById('error-message').style.display = 'none';
        document.getElementById('success-message').style.display = 'none';
        document.getElementById('result-container').style.display = 'none';
        
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
        const formData = {
            product_type_id: parseInt(document.getElementById('product_type_id').value),
            material_type_id: parseInt(document.getElementById('material_type_id').value),
            product_quantity: parseInt(document.getElementById('product_quantity').value),
            param1: parseFloat(document.getElementById('param1').value),
            param2: parseFloat(document.getElementById('param2').value)
        };
        
        try {
            const response = await fetch('/api/calculate-material', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            });
            
            const data = await response.json();
            
            if (!response.ok) {
                // –û—à–∏–±–∫–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
                document.getElementById('error-message').textContent = data.error || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ';
                document.getElementById('error-message').style.display = 'block';
                return;
            }
            
            // –£—Å–ø–µ—à–Ω—ã–π —Ä–∞—Å—á–µ—Ç
            document.getElementById('result-quantity').textContent = data.material_quantity;
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–µ—Ç–∞–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
            const productTypeSelect = document.getElementById('product_type_id');
            const materialSelect = document.getElementById('material_type_id');
            document.getElementById('result-product-type').textContent = productTypeSelect.options[productTypeSelect.selectedIndex].text;
            document.getElementById('result-material').textContent = materialSelect.options[materialSelect.selectedIndex].text;
            document.getElementById('result-product-qty').textContent = data.product_quantity;
            document.getElementById('result-params').textContent = `${data.param1} √ó ${data.param2}`;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            document.getElementById('result-container').style.display = 'block';
            document.getElementById('success-message').textContent = '–†–∞—Å—á–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!';
            document.getElementById('success-message').style.display = 'block';
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
            document.getElementById('result-container').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            
        } catch (error) {
            document.getElementById('error-message').textContent = '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º: ' + error.message;
            document.getElementById('error-message').style.display = 'block';
        }
    });
</script>

{{end}}

